/*!
 *  opentok-layout-js (http://github.com/aullman/opentok-layout-js)
 *  
 *  Automatic layout of video elements (publisher and subscriber) minimising 
 *  white-space for the OpenTok on WebRTC API.
 *
 *  @Author: Adam Ullman (http://github.com/aullman)
 *  @Copyright (c) 2014 Adam Ullman
 *  @License: Released under the MIT license (http://opensource.org/licenses/MIT)
**/
!function(){var t=function(t,i,e,a,o,r){var n={left:i+"px",top:e+"px",width:a+"px",height:o+"px"},g=function(){var i=t.querySelector(".OT_root");if(i){var e=i.style.width;i.style.width=a+"px",i.style.width=e||""}};r&&$?($(t).stop(),$(t).animate(n,r.duration||200,r.easing||"swing",function(){g(),r.complete&&r.complete.call(this)})):OT.$.css(t,n),g()},i=function(t,i){var e=OT.$.css(t,i);return e?parseInt(e,10):0},e=function(t){var i=OT.$.height(t);return i?parseInt(i,10):0},a=function(t){var i=OT.$.width(t);return i?parseInt(i,10):0},o=function(e,a,o,r,n,g,d,l,h){var s,R=e.length,b=function(t,i){for(var e,r,n,g,d,l,h,b=1;R>=b;b++){var f=b,u=Math.ceil(R/f);h=Math.floor(o/u),l=Math.floor(a/f),tRatio=h/l,tRatio>i?(tRatio=i,h=l*tRatio):t>tRatio&&(tRatio=t,l=h/tRatio);var c=l*h*R;(void 0===e||c>e)&&(e=c,g=h,d=l,r=f,n=u)}return{maxArea:e,targetCols:r,targetRows:n,targetHeight:g,targetWidth:d,ratio:s}};if(g){var f=e.length>0&&e[0].querySelector("video");s=f&&f.videoHeight&&f.videoWidth?b(f.videoHeight/f.videoWidth,f.videoHeight/f.videoWidth):b(.75,.75)}else s=b(d,l);for(var u=s.targetRows*s.targetCols-R,c=u*s.targetWidth/2,v=(s.targetRows-1)*s.targetCols,m=(o-s.targetRows*s.targetHeight)/2,p=(a-s.targetCols*s.targetWidth)/2,x=0,T=0,y=0;y<e.length;y++){var M=e[y];y%s.targetCols===0?(x=p,y==v&&(x+=c),T+=0===y?m:s.targetHeight):x+=s.targetWidth,OT.$.css(M,"position","absolute");var O=s.targetWidth-i(M,"paddingLeft")-i(M,"paddingRight")-i(M,"marginLeft")-i(M,"marginRight")-i(M,"borderLeft")-i(M,"borderRight"),$=s.targetHeight-i(M,"paddingTop")-i(M,"paddingBottom")-i(M,"marginTop")-i(M,"marginBottom")-i(M,"borderTop")-i(M,"borderBottom");t(M,x+r,T+n,O,$,h)}},r=function(t){return"none"!==OT.$.css(t,"display")},n=function(t,n){if("none"!==OT.$.css(t,"display")){var g=t.getAttribute("id");g||(g="OT_"+OT.$.uuid(),t.setAttribute("id",g));var d=e(t)-i(t,"borderTop")-i(t,"borderBottom"),l=a(t)-i(t,"borderLeft")-i(t,"borderRight"),h=d/l,s=0,R=0,b=0,f=0,u=Array.prototype.filter.call(t.querySelectorAll("#"+g+">."+n.bigClass),r),c=Array.prototype.filter.call(t.querySelectorAll("#"+g+">*:not(."+n.bigClass+")"),r);if(u.length>0&&c.length>0){var v=u[0].querySelector("video");bigRatio=v&&v.videoHeight&&v.videoWidth?v.videoHeight/v.videoWidth:.75;var m,p;h>bigRatio?(m=l,p=Math.min(Math.floor(d*n.bigPercentage),l*bigRatio),R=p,b=d-R):(p=d,m=Math.min(l*n.bigPercentage,Math.floor(p/bigRatio)),s=m,f=l-s),n.bigFirst?(o(u,m,p,0,0,n.bigFixedRatio,n.bigMinRatio,n.bigMaxRatio,n.animate),o(c,l-s,d-R,s,R,n.fixedRatio,n.minRatio,n.maxRatio,n.animate)):(o(c,l-s,d-R,0,0,n.fixedRatio,n.minRatio,n.maxRatio,n.animate),o(u,m,p,f,b,n.bigFixedRatio,n.bigMinRatio,n.bigMaxRatio,n.animate))}else u.length>0&&0===c.length?o(u,l,d,0,0,n.bigFixedRatio,n.bigMinRatio,n.bigMaxRatio,n.animate):o(c,l-s,d-R,s,R,n.fixedRatio,n.minRatio,n.maxRatio,n.animate)}};if(!TB)throw new Error("You must include the OpenTok for WebRTC JS API before the layout-container library");TB.initLayoutContainer=function(t,i){return i=OT.$.defaults(i||{},{maxRatio:1.5,minRatio:9/16,fixedRatio:!1,animate:!1,bigClass:"OT_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16,bigFirst:!0}),t="string"==typeof t?OT.$(t):t,OT.onLoad(function(){n(t,i)}),{layout:n.bind(null,t,i)}}}();